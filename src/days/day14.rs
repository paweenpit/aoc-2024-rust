fn print_map(positions: &Vec<(i64, i64)>, m: i64, n: i64) {
    let mut map = vec![vec!['.'; n as usize]; m as usize];
    for (x, y) in positions {
        map[*x as usize][*y as usize] = '#';
    }
    for i in 0..n {
        for j in 0..m {
            print!("{}", map[j as usize][i as usize]);
        }
        println!();
    }
}

fn is_reflect_xaxis(positions: &Vec<(i64, i64)>, m: i64, n: i64) -> bool {
    for (x, y) in positions {
        if !positions.contains(&(m - x - 1, *y)) {
            return false;
        }
    }
    true
}

pub fn main() {
    let re = regex::Regex::new(r"p=(\d+),(\d+) v=(-?\d+),(-?\d+)").unwrap();
    let input = std::fs::read_to_string("inputs/day14.input").unwrap();
    let caps: Vec<Vec<i64>> = re
        .captures_iter(&input)
        .map(|cap| {
            cap.iter()
                .skip(1)
                .map(|x| x.unwrap().as_str().parse::<i64>().unwrap())
                .collect::<Vec<i64>>()
        })
        .collect();

    let m = 101;
    let n = 103;
    let round = 100;

    let positions: Vec<_> = caps
        .iter()
        .map(|cap| {
            let x = cap[0];
            let y = cap[1];
            let vx = cap[2];
            let vy = cap[3];
            (
                (x + round * vx).rem_euclid(m),
                (y + round * vy).rem_euclid(n),
            )
        })
        .collect();

    let quadrant_count = positions.iter().fold(vec![0, 0, 0, 0], |mut acc, (x, y)| {
        if *x < &m / 2 && *y < &n / 2 {
            acc[0] += 1;
        } else if *x > &m / 2 && *y < &n / 2 {
            acc[1] += 1;
        } else if *x < &m / 2 && *y > &n / 2 {
            acc[2] += 1;
        } else if *x > &m / 2 && *y > &n / 2 {
            acc[3] += 1;
        }
        acc
    });

    let total = quadrant_count.iter().product::<i64>();

    println!("Part 1: {}", total);

    let mut r = 8150;
    loop {
        r += 1;
        let pos: Vec<_> = caps
            .iter()
            .map(|cap| {
                let x = cap[0];
                let y = cap[1];
                let vx = cap[2];
                let vy = cap[3];
                ((x + r * vx).rem_euclid(m), (y + r * vy).rem_euclid(n))
            })
            .collect();
        println!("Round: {}", r);
        print_map(&pos, m, n);
        std::io::stdin().read_line(&mut String::new()).unwrap();
        // if r % 10000 == 0 {
        //     println!("Round: {}", r);
        // }
        // if is_reflect_xaxis(&pos, m, n) {
        //     println!("Part 2: {}", r);
        //     print_map(&pos, m, n);
        //     break;
        // }
    }
}

/*

Round: 8159
..............................................#......................................................
.#....#......#....................................#..................................................
...........................................................#.........................................
.....................................................................................................
.............................................................................#.......................
.....................................................................................................
......................................................#..............................................
......................#..............................................................................
...............................................#.....................................................
.....................#...................................................................#...........
.....................................................................................................
....#...............#................................................................................
.....................................................................................................
.............#...................................................#.................................#.
....#.....#...................................................................#......................
............#......................................................#.................................
.........................#..........................................................#................
..............................#.............................................#........................
.....................#...............................................................................
...............................#.....................................#...............................
........................#...........................#................................................
...........................................................................................#.........
...............#.................................#.............#..........#........................#.
..........................................#.........................................................#
..................................................#..................................................
..................................................................#.....................#............
.....................#......................#................#............................#..........
.....................................................................................................
.........................##...........#..........#...................................................
#.....................#..................#............#..........................................#...
....................................................#............................................#...
..............#..................................................#...................................
..#..................................................................................................
.....................................................................................................
.....................................................................................................
................#....................................................................................
............#..........###############################...............................................
.......................#.............................#...............................................
.......................#.............................#...............................................
.......................#.............................#...............................................
.......................#.............................#...............................................
.......................#..............#..............#...............................#...............
.................#.....#.............###.............#...................#...........................
.......................#............#####............#...............................................
.......................#...........#######...........#...............................................
.......................#..........#########..........#..............................#...#............
.......................#............#####............#.......................#.......................
.......................#...........#######...........#...............................................
.......................#..........#########..........#..........................................#....
.......................#.........###########.........#.....................#.........................
.......................#........#############........#...............................................
.......................#..........#########..........#...............................................
.......................#.........###########.........#....................#........#...............#.
..#....................#........#############........#...............................................
.......................#.......###############.......#...............................................
.......................#......#################......#..........#....................................
.......................#........#############........#..............#................#...#...........
.......................#.......###############.......#...#......#....................................
........#........#.....#......#################......#...............................................
.............##........#.....###################.....#...............................................
.......................#....#####################....#........................................#......
.......................#.............###.............#....................#..........................
.......................#.............###.............#............................#..................
.......................#.............###.............#...............................................
..........#............#.............................#...............................................
.......................#.............................#...............................................
.......................#.............................#...................#............#..............
...#...................#.............................#...............................................
.......................###############################.........................#............#........
....................................................................................#................
........................................................................#...........................#
...................................#................#..........................#.....................
..............................................................................................#......
................#...................................................#..........................##....
....#.............................................................................#..................
.........................................................................#...........................
......#.#............................................................................................
#....................................................................................................
.....................................................................................#...............
...............................................................#...........................#.........
...................................................................................#...#.............
.....................................................................................................
#....................................................................................................
......................................................................#..............................
.........#...........................................................................................
..........#..........................................................................................
................#...................#...#.........................................#..................
.....................................................#...............................................
..........#..........................................................................................
.....................................................................................................
........#..................................................#...............................#.........
.....................................................................................................
................................#....................................................................
........................#...........................................#................................
...................................................................#........................#........
.....................................#...........................#...................................
......................#...#.......................................................................#..
.............................................................#........#.#............................
..........................................................#..........................................
.........#......................................................................#....................
...............................................................................#.....................
.....................................................................................................
..........#............................#.............................................................

*/
